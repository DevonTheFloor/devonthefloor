<!doctype html>
<html data-n-head-ssr lang="fr" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22fr%22%7D%7D">
  <head>
    <title>Paramètrage de Happy DOM dans vitest</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Le paramétrage de happy-dom dans les tests unitaires avec ViTest."><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="Paramètrage de Happy DOM dans vitest"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="Le paramétrage de happy-dom dans les tests unitaires avec ViTest."><meta data-n-head="ssr" property="og:type" content="Web site"><meta data-n-head="ssr" property="og:image" content="https://thierry-go-dev.fr/tourn/images/blog/vitesthappy.png"><meta data-n-head="ssr" data-hid="twitter:title" name="twitter:title" content="Paramètrage de Happy DOM dans vitest"><meta data-n-head="ssr" data-hid="twitter:description" name="twitter:description" content="Le paramétrage de happy-dom dans les tests unitaires avec ViTest."><meta data-n-head="ssr" name="twitter:image" content="https://thierry-go-dev.fr/tourn/images/blog/vitesthappy.png"><link data-n-head="ssr" rel="preconnect" href="https://fonts.gstatic.com"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/chefjs.ico"><link rel="preload" href="/_nuxt/4c57565.js" as="script"><link rel="preload" href="/_nuxt/8e6d856.js" as="script"><link rel="preload" href="/_nuxt/6575eff.js" as="script"><link rel="preload" href="/_nuxt/dd2ffe0.js" as="script"><link rel="preload" href="/_nuxt/248d37e.js" as="script"><link rel="preload" href="/_nuxt/e90d4ee.js" as="script"><style data-vue-ssr-id="517a8dd7:0">code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style data-vue-ssr-id="fa7ff0ca:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;-webkit-transition:width .1s,opacity .4s;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{-webkit-transition:none;transition:none}.nuxt-progress-failed{background-color:red}</style><style data-vue-ssr-id="56b15182:0">html{background-color:#469583;padding:1vw;font-family:"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-box-sizing:border-box;box-sizing:border-box}body{background-color:#f8f5f5;width:100%;height:100%;border:2px solid #355e50;border-radius:8px}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0}.button--green{display:inline-block;border-radius:4px;border:1px solid #3b8070;color:#3b8070;text-decoration:none;padding:10px 30px}.button--green:hover{color:#fff;background-color:#3b8070}.button--grey{display:inline-block;border-radius:4px;border:1px solid #35495e;color:#35495e;text-decoration:none;padding:10px 30px;margin-left:15px}.button--grey:hover{color:#fff;background-color:#35495e}</style><style data-vue-ssr-id="083745fe:0">article{padding:5%;text-align:justify;width:100%}code{display:block;padding:2%;width:90%;margin:auto}.filename{display:block;text-align:center;color:#57c54d}div.nuxt-content-highlight{background-color:#eaf5e7;display:block;border:1px solid grey;max-width:60%;min-width:55%;margin:2% auto}.vdo{width:90%;margin:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}iframe{max-width:75%;min-width:40%;height:315px}.title-blog{font-family:"Dancing Script",cursive;font-size:50px;text-align:center}.illustration{width:100%;padding:2%;display:-webkit-box;display:-ms-flexbox;display:flex;justify-items:center}.illustration img{max-width:50%;border:1px solid green;margin:auto}h1{width:100%;color:#469583;text-align:center;border:2 solid green}h1,h2{margin:1%}h2{font-family:"Dancing Script",cursive;color:#569546}p{font-family:"Cutive Mono",monospace;margin:2%;padding:1%;color:#01130f}.illu{width:100%;padding:2%;display:-webkit-box;display:-ms-flexbox;display:flex;justify-items:center}.illu img{max-width:20%;border:1px solid green;margin:auto}@media screen and (max-width:850px){.profile{min-width:12vw}.title{padding:1%;font-size:80px}.links{margin:2%}div.nuxt-content-highlight{max-width:70%;min-width:65%}p{font-size:1.25em}}@media screen and (max-width:470px){.title{padding:2%;font-size:70px}.links{margin:1%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.profile{min-width:15vw}.btn-custom{max-width:60vw;margin:1vh}p{padding:5%}div.nuxt-content-highlight{max-width:90%;min-width:85%}h1{font-size:2em}}</style><style data-vue-ssr-id="52e054e0:0">header{border:2px ridge #0c4d0c}.bann{width:100%;height:100%;-o-object-fit:cover;object-fit:cover;position:relative;opacity:.8}.bann__article{height:500px}.bann__titre{margin:auto;z-index:1;position:absolute;top:100px;font-size:5em;padding:2%;color:#3eff04;text-align:center;text-shadow:2px 2px 2px #000;width:90%}@media screen and (max-width:850px){.bann__titre{font-size:3em}}</style><style data-vue-ssr-id="55826201:0">.navblog[data-v-55a24a3e]{margin:2%;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.btn-blog[data-v-55a24a3e]{margin:1%}@media screen and (max-width:500px){.navblog[data-v-55a24a3e]{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.btn-blog[data-v-55a24a3e]{text-align:center}.other[data-v-55a24a3e]{color:red}}</style><link rel="preload" href="/_nuxt/static/1723989527/blog/parametrage-happy-dom/state.js" as="script"><link rel="preload" href="/_nuxt/static/1723989527/blog/parametrage-happy-dom/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1723989527/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div><header class="bann__article"><img src="https://thierry-go-dev.fr/tourn/images/blog/vitesthappy.png" class="bann"> <h1 class="bann__titre">
      Paramètrage de Happy DOM dans vitest
    </h1></header> <p>Le paramétrage de happy-dom dans les tests unitaires avec ViTest.</p> <div class="nuxt-content"><p>Lorsque l'on fait des tests avec ViTest, l'environnement par défaut est Node.js. Cependant, si l'on souhaite tester la manipulation du DOM, il est nécessaire de substituer cet environnement Node.js par celui du navigateur.<br>
Bien entendu, au lieu d'utiliser un véritable navigateur pour ces tests, on utilisera une émulation.<br>
Pendant longtemps, la bibliothèque JSDOM était le choix par défaut pour cette tâche. Cependant, aujourd'hui, une alternative plus efficace et conviviale est disponible : Happy-DOM.<br>
Cette surcouche DOM légère offre une solution simple et puissante pour faciliter la manipulation des éléments du DOM lors des tests avec ViTest.</p>
<h2 id="pourquoi-happy-dom-est-plus-pratique-que-jsdom"><a href="#pourquoi-happy-dom-est-plus-pratique-que-jsdom" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Pourquoi happy-dom est plus pratique que JSDOM?</h2>
<p>Contrairement a JSDOM toutes les fonctionnalités native du DOM, telles que "document.create" et autre "getElementById", exsite dans happy-dom, alors qu'avec JSDOM il faut toutes les mocker.
On peut donc utiliser des sélecteurs CSS ou des attributs pour cibler les éléments, rendant les tests plus lisibles et compréhensibles.</p>
<h2 id="installation"><a href="#installation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Installation</h2>
<p>Dans ton projet vitest installe happy-dom, classiquement:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> happy-dom
</code></pre></div>
<p>Sur la <a href="https://github.com/capricorn86/happy-dom/wiki/Getting-started" rel="nofollow noopener noreferrer" target="_blank">page du wiki dédié</a> tu trouveras le script d'initialisation du DOM:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-js"><code><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Window</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'happy-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token dom variable">window</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Window</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://localhost:8080'</span><span class="token punctuation">,</span>
   <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
   <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token dom variable">document</span> <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">;</span>

<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token string">'&lt;div class="container">&lt;/div>'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'.container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> button <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Outputs "&lt;div class="container">&lt;button>&lt;/button>&lt;/div>"</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
</code></pre></div>
<p>Le premier problème surviendra très rapidement sous une forme similaire à celle ci:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-shell"><code>ReferenceError: document is not defined
 ❯ js/module-liste/index.js:3:15
      <span class="token number">1</span><span class="token operator">|</span> <span class="token function">import</span> <span class="token punctuation">{</span> dGEBId, dCrEl <span class="token punctuation">}</span> from <span class="token string">"../modules/dom-helpers.js"</span><span class="token punctuation">;</span>
      <span class="token number">2</span><span class="token operator">|</span> 
      <span class="token number">3</span><span class="token operator">|</span> const <span class="token function">mount</span> <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'mount-point'</span><span class="token punctuation">)</span>,
       <span class="token operator">|</span>               ^
      <span class="token number">4</span><span class="token operator">|</span>   body <span class="token operator">=</span> document.querySelector<span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span>,
      <span class="token number">5</span><span class="token operator">|</span>   numt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1,2</span>,3,4,5<span class="token punctuation">]</span>,
 ❯ js/module-liste/__test__/indexTest.spec.js:2:31
</code></pre></div>
<p>Problème facilement resolu en ce référant à <a href="https://vitest.dev/config/#environment" rel="nofollow noopener noreferrer" target="_blank">la documentation de Vitest</a> pour initialiser l'environnement.<br>
Une fois happy-dom initialiser dans tes tests en comments style (par exemple), document sera reconnu. Tu pourras donc tester ta fabuleuse fonction qui manipule le DOM et bien plus encore.</p>
<p>Alors , on est pas bien là?
A dev secure, détendu du test ?</p>
<p>Sur ce, bon week et la semaine prochaiiiièène !</p></div> <br> <p> Views:  </p> <nav class="navblog" data-v-55a24a3e><a href="/blog/sommaire" class="button--green btn-blog btn-custom som" data-v-55a24a3e>
    Sommaire Blog
  </a> <a href="/" class="button--green btn-blog btn-custom nuxt-link-active" data-v-55a24a3e>
    Accueil
  </a></nav> <br></div></div></div></div><script defer src="/_nuxt/static/1723989527/blog/parametrage-happy-dom/state.js"></script><script src="/_nuxt/4c57565.js" defer></script><script src="/_nuxt/248d37e.js" defer></script><script src="/_nuxt/e90d4ee.js" defer></script><script src="/_nuxt/8e6d856.js" defer></script><script src="/_nuxt/6575eff.js" defer></script><script src="/_nuxt/dd2ffe0.js" defer></script>
  </body>
</html>
